name: SonarCloud
on: [push, pull_request]

jobs:
  sonarcloud:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Qt (skip build errors)
      run: |
        sudo apt update
        sudo apt install -y qt5-default || true
        echo "Qt setup attempted"
      continue-on-error: true
    
    - name: SonarCloud Scan
      uses: SonarSource/sonarcloud-github-action@master
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
      with:
        args: >
          -Dsonar.cfamily.build-wrapper-output.bypass=true
          -Dsonar.cfamily.analysis.timeout=300
